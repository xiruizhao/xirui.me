<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Tools | Xirui Zhao’s blog</title>
  <meta name="description" content="3 Tools | Xirui Zhao’s blog" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Tools | Xirui Zhao’s blog" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Tools | Xirui Zhao’s blog" />
  
  
  

<meta name="author" content="Xirui Zhao" />


<meta name="date" content="2021-12-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="political-philosophy.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="study-guides.html"><a href="study-guides.html"><i class="fa fa-check"></i><b>1</b> Study Guides</a>
<ul>
<li class="chapter" data-level="1.1" data-path="study-guides.html"><a href="study-guides.html#computer-science"><i class="fa fa-check"></i><b>1.1</b> Computer Science</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="political-philosophy.html"><a href="political-philosophy.html"><i class="fa fa-check"></i><b>2</b> Political Philosophy</a>
<ul>
<li class="chapter" data-level="2.1" data-path="political-philosophy.html"><a href="political-philosophy.html#utilitarianism-does-not-take-seriously-the-distinction-between-persons"><i class="fa fa-check"></i><b>2.1</b> Utilitarianism does not take seriously the distinction between persons</a></li>
<li class="chapter" data-level="2.2" data-path="political-philosophy.html"><a href="political-philosophy.html#the-chamberlain-argument-against-redistribution-wip"><i class="fa fa-check"></i><b>2.2</b> The Chamberlain argument against redistribution (WIP)</a></li>
<li class="chapter" data-level="2.3" data-path="political-philosophy.html"><a href="political-philosophy.html#what-is-the-point-of-equality"><i class="fa fa-check"></i><b>2.3</b> What is the point of equality?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>3</b> Tools</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tools.html"><a href="tools.html#git-notes"><i class="fa fa-check"></i><b>3.1</b> Git Notes</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="tools.html"><a href="tools.html#work-in-progress"><i class="fa fa-check"></i><b>3.1.1</b> Work In Progress</a></li>
<li class="chapter" data-level="3.1.2" data-path="tools.html"><a href="tools.html#history"><i class="fa fa-check"></i><b>3.1.2</b> History</a></li>
<li class="chapter" data-level="3.1.3" data-path="tools.html"><a href="tools.html#working-with-long-histories"><i class="fa fa-check"></i><b>3.1.3</b> Working with long histories</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tools.html"><a href="tools.html#webdav-server-for-zotero-library"><i class="fa fa-check"></i><b>3.2</b> WebDav Server for Zotero Library</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="tools.html"><a href="tools.html#prerequisitives"><i class="fa fa-check"></i><b>3.2.1</b> Prerequisitives</a></li>
<li class="chapter" data-level="3.2.2" data-path="tools.html"><a href="tools.html#steps"><i class="fa fa-check"></i><b>3.2.2</b> Steps</a></li>
<li class="chapter" data-level="3.2.3" data-path="tools.html"><a href="tools.html#testing"><i class="fa fa-check"></i><b>3.2.3</b> Testing</a></li>
<li class="chapter" data-level="3.2.4" data-path="tools.html"><a href="tools.html#other-clients-compatible-with-zotero-library"><i class="fa fa-check"></i><b>3.2.4</b> Other clients compatible with Zotero Library</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Xirui Zhao’s blog</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tools" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Tools</h1>
<p>_</p>
<div id="git-notes" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Git Notes</h2>
<p>Git version 2.28.0</p>
<div id="work-in-progress" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Work In Progress</h3>
<div id="inspect-wip" class="section level4" number="3.1.1.1">
<h4><span class="header-section-number">3.1.1.1</span> Inspect WIP</h4>
<ol style="list-style-type: decimal">
<li><code>git status</code> shows the list of files with staged and unstaged changes and untracked files.</li>
<li><code>git diff</code> shows unstaged changes (worktree v index)</li>
<li><code>git diff --staged</code> show staged changes (index v HEAD)</li>
<li><code>git diff @</code> shows unstaged and staged changes (worktree, index v HEAD). (@ is a shortcut for HEAD. See <strong><a href="https://www.git-scm.com/docs/gitrevisions">gitrevisions</a></strong>)</li>
<li><code>&lt;pathspec&gt;</code> add be added at the end, e.g., <code>:/</code> stands for repository root.</li>
</ol>
</div>
<div id="discard-wip" class="section level4" number="3.1.1.2">
<h4><span class="header-section-number">3.1.1.2</span> Discard WIP</h4>
<ol style="list-style-type: decimal">
<li><code>git clean -f &lt;path&gt;</code> removes untracked files</li>
<li><code>git restore &lt;pathspec&gt;</code> discards unstaged changes (working =&gt; index)</li>
</ol>
<ul>
<li>alternatively, <code>git checkout &lt;pathspec&gt;</code></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><strong>Undo <code>git add</code></strong>: <code>git restore --staged &lt;pathspec&gt;</code> unstages staged changes (index =&gt; HEAD) or <code>git rm --cached &lt;pathspec&gt;</code> if a new file was added</li>
</ol>
<ul>
<li>alternatively, <code>git reset &lt;pathspec&gt;</code>, <code>git reset</code> (the whole repository), <code>git reset -p</code> (interactively select chunks to unstage)</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><code>git restore --source=HEAD --staged --worktree &lt;pathspec&gt;</code> discards unstaged and staged changes (worktree, index =&gt; HEAD). Shorthand: <code>git restore -s@ -SW &lt;pathspec&gt;</code></li>
</ol>
<ul>
<li>alternatively, <code>git checkout @ &lt;pathspec&gt;</code> and <code>git reset --hard</code> (the whole repository).</li>
</ul>
<p>Note: <code>git reset</code> “resets current HEAD to the specified state” (and changes the worktree and the index accordingly) while <code>git restore</code> does not move HEAD.</p>
</div>
<div id="save-and-reapply-wip" class="section level4" number="3.1.1.3">
<h4><span class="header-section-number">3.1.1.3</span> Save and reapply WIP</h4>
<ol style="list-style-type: decimal">
<li><code>git stash</code> stashes unstaged and staged changes (untracked files are excluded) to a stash stack</li>
</ol>
<ul>
<li><code>git stash -u</code> includes untracked files (excluding ignored files); <code>git statsh -a</code> includes even ignored files</li>
<li><code>git stash -p</code> is interactive</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><code>git stash pop</code> applies the most recent local stash (previously staged changes are restored as unstaged) and drops it from the stash stack</li>
</ol>
<ul>
<li><code>git stash pop  --index</code> restores staged changes as staged</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><code>git stash apply</code> applies the most recent local stash but</li>
<li><code>git stash drop</code> drops the most recent local stash from the stash stack</li>
</ol>
<ul>
<li><code>git stash list</code> lists saved stashes</li>
<li><code>git stash show n</code> inspects n-th stash (0-th is the most recent one)</li>
<li><code>git stash apply n</code> applies the n-th stash from the stash stack</li>
<li><code>git stash clear</code> clears the stash stack</li>
</ul>
</div>
<div id="somewhat-odd-alternative-to-git-stash" class="section level4" number="3.1.1.4">
<h4><span class="header-section-number">3.1.1.4</span> (Somewhat odd) alternative to <code>git stash</code></h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="tools.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> worktree add <span class="at">-b</span> hotfix ../hotfix</span>
<span id="cb1-2"><a href="tools.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ../hotfix</span>
<span id="cb1-3"><a href="tools.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># work on it ...</span></span>
<span id="cb1-4"><a href="tools.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span> <span class="st">&quot;fix #xxx&quot;</span></span>
<span id="cb1-5"><a href="tools.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># change to previous worktree</span></span>
<span id="cb1-6"><a href="tools.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> reset <span class="at">--soft</span> hotfix <span class="co"># WIP in current worktree untouched but HEAD updated</span></span>
<span id="cb1-7"><a href="tools.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push</span>
<span id="cb1-8"><a href="tools.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> worktree remove ../hotfix</span></code></pre></div>
</div>
</div>
<div id="history" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> History</h3>
<div id="inspect-history" class="section level4" number="3.1.2.1">
<h4><span class="header-section-number">3.1.2.1</span> Inspect history</h4>
<ol style="list-style-type: decimal">
<li><code>git log --stat</code></li>
<li><code>git log -p</code></li>
<li><code>git log &lt;file&gt;</code></li>
</ol>
</div>
<div id="rewrite-history" class="section level4" number="3.1.2.2">
<h4><span class="header-section-number">3.1.2.2</span> Rewrite history</h4>
<div id="rewrite-undo-and-revert-last-commit" class="section level5" number="3.1.2.2.1">
<h5><span class="header-section-number">3.1.2.2.1</span> Rewrite, undo and revert last commit</h5>
<ol style="list-style-type: decimal">
<li><code>git commit --amend</code> replaces your last commit with a new commit.</li>
</ol>
<ul>
<li>supply <code>-m</code> to change commit message or <code>--no-edit</code> to keep it unchanged</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><code>git reset --hard @~</code> rolls HEAD back to the second last commit and restores the worktree and the index.</li>
<li><code>git revert @</code> makes a new commit to revert the changes introduced in last commit.</li>
</ol>
</div>
<div id="squash-split-and-rewrite-past-commits" class="section level5" number="3.1.2.2.2">
<h5><span class="header-section-number">3.1.2.2.2</span> Squash, split, and rewrite past commits</h5>
<ol style="list-style-type: decimal">
<li><code>git rebase --root -i</code>. See <a href="https://git-scm.com/book/en/v2/Git-Tools-Rewriting-History#_changing_multiple">Rewriting History</a> of <em>Pro Git</em>.</li>
</ol>
<ul>
<li>Squash all commits: <code>git reset $(git commit-tree @^{tree} -m "Squash all commits")</code> creates a new commit out of the tree object corresponding to HEAD and resets HEAD to it (source: <a href="https://stackoverflow.com/questions/1657017/how-to-squash-all-git-commits-into-one">StackOverflow</a>). Note that some unreachable past commits are still available in your local reflog and unreachable objects are available in your local object database, which will expire by default. Reflogs and unreachable objects are <strong>not</strong> transfered by <code>git push</code>.</li>
</ul>
</div>
</div>
</div>
<div id="working-with-long-histories" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Working with long histories</h3>
<ol style="list-style-type: decimal">
<li><code>git clone --depth 1 &lt;repos&gt;</code></li>
<li><code>git fetch origin &lt;remote_branch&gt;:&lt;local_branch&gt;</code></li>
<li><code>git clone --depth 1 --no-single-branch &lt;repos&gt;</code> (equivalent to 1. and <code>git fetch --depth 1 origin 'refs/heads/*:refs/remotes/origin/*'</code>)</li>
<li><code>git fetch --deepen 1</code></li>
</ol>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="webdav-server-for-zotero-library" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> WebDav Server for Zotero Library</h2>
<p>2021-01-21</p>
<ol style="list-style-type: decimal">
<li>Motivation: Zotero Library’s free space is only 300MB.</li>
<li>Caveat: Group Library is not supported.</li>
</ol>
<div id="prerequisitives" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Prerequisitives</h3>
<ol style="list-style-type: decimal">
<li>VPS</li>
<li>domain name</li>
</ol>
</div>
<div id="steps" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Steps</h3>
<ol style="list-style-type: decimal">
<li>Install vanilla caddy per <a href="https://caddyserver.com/docs/install#debian-ubuntu-raspbian" class="uri">https://caddyserver.com/docs/install#debian-ubuntu-raspbian</a>, which contains systemd service files</li>
<li>Install caddy compiled with webdav module. You can customize included modules at <a href="https://caddyserver.com/download" class="uri">https://caddyserver.com/download</a>. Unfortunately, this step has to be repeated whenever caddy is upgraded.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="tools.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-o</span> /tmp/caddy <span class="st">&#39;https://caddyserver.com/api/download?os=linux&amp;arch=amd64&amp;p=github.com%2Fmholt%2Fcaddy-webdav&amp;idempotency=92814018723469&#39;</span></span>
<span id="cb2-2"><a href="tools.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> install <span class="at">-o</span> root <span class="at">-m</span> 755 /tmp/caddy /usr/bin/caddy</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Generate password for HTTP Basic Authentication <code>caddy hash-password &gt; passwd_hash # input your passwd on stdin</code></li>
<li><code>sudo mkdir -p /var/www/zotero</code></li>
<li>Put in <code>/etc/caddy/Caddyfile</code>:</li>
</ol>
<pre><code>example.com {
    basicauth {
        # username passwd_hash
        zotero xxxx
    }
    root /zotero/* /var/www
    webdav /zotero/*
}</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Reload caddy config <code>sudo systemctl reload caddy</code></li>
</ol>
</div>
<div id="testing" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Testing</h3>
<p><a href="https://directory.fsf.org/wiki/Cadaver">cadaver</a> is a command-line WebDav client, suitable for testing: <code>cadaver https://example.com/zotero/</code></p>
</div>
<div id="other-clients-compatible-with-zotero-library" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Other clients compatible with Zotero Library</h3>
<p><a href="https://www.papershipapp.com">Papership</a> has macOS and iOS apps that can sync with Zotero and personal WebDav servers. You should run <code>sudo touch /var/www/zotero/lastsync.txt</code> on the WebDav server on first use.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="political-philosophy.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
